<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TermOS: Galactic [Module Build]</title>
    
    <!-- PWA METADATA -->
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- FONTS (Google Fonts via CDN) -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@300;400;600&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">

    <!-- HIGHLIGHT.JS (Loaded globally for module access) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <!-- INTERNAL CSS (Tailwind-like styling without build step) -->
    <style>
        :root {
            --bg-dark: #050505;
            --neon-purple: #a855f7;
            --neon-cyan: #06b6d4;
            --glass-bg: rgba(20, 20, 20, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --font-header: 'Orbitron', sans-serif;
            --font-ui: 'Inter', sans-serif;
            --font-mono: 'Fira Code', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            background-color: var(--bg-dark);
            color: #e5e5e5;
            font-family: var(--font-ui);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .relative { position: relative; }
        .fixed { position: fixed; }
        .inset-0 { top: 0; left: 0; right: 0; bottom: 0; }
        .pointer-none { pointer-events: none; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-50 { z-index: 50; }
        .z-100 { z-index: 100; }
        
        /* Components */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
        }

        .btn-icon { 
            cursor: pointer; border: none; background: transparent; color: inherit; 
            padding: 0.5rem; border-radius: 50%; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .btn-icon:hover { background: rgba(255,255,255,0.1); }
        .btn-ghost { 
            font-family: var(--font-mono); font-size: 0.7rem; padding: 0.3rem 0.75rem; 
            border: 1px solid var(--glass-border); border-radius: 99px; cursor: pointer; 
            background: rgba(0,0,0,0.3); color: inherit; transition: 0.2s;
        }
        .btn-primary {
            background: linear-gradient(to right, #9333ea, #4f46e5);
            color: white; padding: 0.5rem; border-radius: 0.5rem;
            border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        input[type="text"], input[type="password"], textarea {
            background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
            color: white; border-radius: 0.375rem; padding: 0.5rem;
            font-family: var(--font-mono); width: 100%; transition: 0.2s;
        }
        input:focus, textarea:focus { border-color: var(--neon-purple); }

        /* Header */
        header { height: 4rem; padding: 0 1rem; background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between; }
        .logo-box { 
            width: 2.5rem; height: 2.5rem; background: linear-gradient(135deg, #7e22ce, #2563eb); 
            border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; 
            border: 1px solid rgba(255,255,255,0.2); position: relative; 
        }
        .logo-box::after { content:''; position:absolute; inset:0; background:inherit; filter:blur(8px); opacity:0.6; z-index:-1; }

        /* Chat */
        #chat-container { flex: 1; overflow-y: auto; padding: 5rem 1rem 8rem 1rem; scroll-behavior: smooth; max-width: 1000px; margin: 0 auto; width: 100%; }
        #chat-container::-webkit-scrollbar { width: 6px; }
        #chat-container::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        .message { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; animation: fadeIn 0.3s ease-out; }
        .message.user { margin-left: auto; flex-direction: row-reverse; }
        .avatar { width: 2rem; height: 2rem; border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; flex-shrink: 0; }
        .avatar.ai { background: linear-gradient(135deg, #a855f7, #2563eb); }
        .avatar.user { background: #4b5563; }
        .bubble { padding: 1rem; border-radius: 0.5rem; font-size: 0.9rem; line-height: 1.6; box-shadow: 0 4px 6px rgba(0,0,0,0.2); max-width: 85%; }
        .message.ai .bubble { border-top-right-radius: 0; border: 1px solid var(--glass-border); }
        .message.user .bubble { background: rgba(147, 51, 234, 0.2); border: 1px solid rgba(168, 85, 247, 0.2); border-top-left-radius: 0; }

        /* Input */
        #input-area { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); border-top: 1px solid var(--glass-border); padding: 0.75rem 1rem 1.5rem 1rem; display: flex; justify-content: center; z-index: 30; }
        #chat-form { width: 100%; max-width: 56rem; display: flex; gap: 0.5rem; background: rgba(20,20,20,0.6); padding: 0.25rem; border-radius: 0.75rem; border: 1px solid var(--glass-border); transition: 0.2s; }
        #chat-form:focus-within { border-color: rgba(168, 85, 247, 0.4); box-shadow: 0 0 15px rgba(168,85,247,0.1); }

        /* Overlays */
        #boot-screen { background: black; z-index: 100; }
        .loader { width: 50px; height: 50px; border: 3px solid rgba(168, 85, 247, 0.1); border-left-color: var(--neon-purple); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Admin */
        #admin-panel { position: fixed; bottom: 5rem; right: 1rem; left: 1rem; max-width: 20rem; margin-left: auto; padding: 1.25rem; border: 1px solid rgba(239, 68, 68, 0.3); z-index: 50; }
        
        /* Media Deck */
        #media-deck { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); width: 90%; max-width: 500px; padding: 0.75rem; border: 1px solid rgba(168, 85, 247, 0.3); box-shadow: 0 0 50px rgba(168,85,247,0.1); z-index: 40; opacity: 0; pointer-events: none; transition: all 0.3s; }
        #media-deck.active { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }

        /* IDE */
        #code-editor-overlay { position: fixed; inset: 0; z-index: 100; background: #0d1117; display: flex; flex-direction: column; }
        .editor-toolbar { height: 3rem; border-bottom: 1px solid #30363d; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center; background: #161b22; }
        .editor-layout { flex: 1; display: flex; overflow: hidden; position: relative; }
        #code-area { flex: 1; background: #0d1117; color: #e6edf3; border: none; padding: 1rem; font-family: var(--font-mono); resize: none; font-size: 0.9rem; }
        #preview-area { position: absolute; bottom: 0; right: 0; width: 400px; height: 300px; background: white; border-top: 1px solid #30363d; display: none; z-index: 10; }
        #preview-area.show { display: block; }

        /* Markdown Styles */
        pre { background: rgba(0,0,0,0.6) !important; padding: 1rem !important; border-radius: 0.5rem !important; border: 1px solid #333; margin: 0.5rem 0; overflow-x: auto; }
        code { font-family: var(--font-mono); color: var(--neon-cyan); }
        p { margin-bottom: 0.5rem; }
        p:last-child { margin-bottom: 0; }
        
        /* Scanlines */
        .scanlines { position: fixed; inset: 0; pointer-events: none; z-index: 90; background: linear-gradient(to bottom, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%); background-size: 100% 4px; }
    </style>
</head>
<body>

    <!-- VISUAL FX -->
    <div class="scanlines"></div>
    <canvas id="galaxy-canvas" class="fixed inset-0 z-0 pointer-none"></canvas>

    <!-- BOOT SCREEN -->
    <div id="boot-screen" class="fixed inset-0 flex flex-col items-center justify-center">
        <div class="loader mb-6"></div>
        <h1 class="text-3xl font-header text-white tracking-[0.2em] animate-pulse">TERMOS <span class="text-purple" style="color:var(--neon-purple)">GALACTIC</span></h1>
        <div class="mt-4 font-mono text-xs text-cyan flex gap-2 items-center" style="color:var(--neon-cyan)">
            <span style="width:6px;height:6px;background:currentColor;border-radius:50%;animation:ping 1s infinite"></span>
            <span id="txt-init">INITIALIZING NEURAL LINK...</span>
        </div>
    </div>

    <!-- HEADER -->
    <header class="z-20 glass">
        <div class="flex items-center gap-3">
            <div class="logo-box">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            </div>
            <div>
                <h1 class="font-header font-bold text-lg hidden sm:block text-white">TERMOS <span style="color:var(--neon-purple)">GALACTIC</span></h1>
                <div class="flex items-center gap-2 text-[10px] text-gray font-mono">
                    <div id="api-status-dot" style="width:6px;height:6px;border-radius:50%;background:red"></div>
                    <span id="room-display">SYSTEM READY</span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <button id="btn-media-deck" class="btn-icon" style="color:var(--neon-purple)" title="Media Deck">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            </button>
            <button id="btn-ide" class="hidden sm:flex btn-ghost" style="color:var(--neon-purple)">ðŸ–‹ IDE</button>
            <button id="btn-admin" class="btn-icon" style="color:#ef4444" title="System Console">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
            </button>
        </div>
    </header>

    <!-- MAIN CHAT AREA -->
    <main id="chat-container">
        <div class="message ai">
            <div class="avatar ai">AI</div>
            <div class="bubble glass">
                <p class="text-cyan text-xs font-mono mb-2" style="color:var(--neon-cyan)">>> SYSTEM ONLINE. GROQ NEURAL LINK STANDBY.</p>
                <p>Welcome to TermOS Galactic. Use <code>/ai [prompt]</code> to chat, or configure your API key in the Admin Panel.</p>
            </div>
        </div>
    </main>

    <!-- INPUT AREA -->
    <div id="input-area">
        <form id="chat-form">
            <button type="button" class="btn-icon" style="color:var(--neon-cyan)" title="Ask AI">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
            </button>
            <input type="text" id="user-input" placeholder="Command: /ai [prompt], /help..." autocomplete="off" style="background:transparent;border:none;flex:1;">
            <button type="submit" class="btn-primary px-3">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
            </button>
        </form>
    </div>

    <!-- ADMIN PANEL -->
    <div id="admin-panel" class="glass hidden">
        <h3 class="text-red text-xs font-bold mb-4 uppercase flex justify-between" style="color:#ef4444">System Console <span class="bg-red-900 text-white px-1 rounded text-[9px]">GEN 2</span></h3>
        <form id="admin-form" class="flex flex-col gap-3">
            <div>
                <label class="text-gray text-[9px] uppercase font-bold block mb-1">Neural API Key (Groq)</label>
                <input type="password" id="api-key-input" placeholder="gsk_...">
            </div>
            <button type="submit" class="bg-red-900 text-red-200 text-xs font-bold py-2 rounded border border-red-700 hover:bg-red-800" style="background:rgba(127,29,29,0.4);color:#fecaca">SAVE & RECONNECT</button>
            <hr style="border-color:var(--glass-border)">
            <button type="button" id="btn-reset-sys" class="bg-white/5 text-white text-xs font-bold py-1.5 rounded hover:bg-red-900/30">EMERGENCY SYSTEM RESET</button>
        </form>
    </div>

    <!-- MEDIA DECK -->
    <div id="media-deck" class="glass">
        <div class="flex justify-between items-center p-2 border-b border-white/10 bg-black/40">
            <span class="text-xs font-bold text-cyan" style="color:var(--neon-cyan)">MEDIA DECK</span>
            <button id="btn-close-deck" class="text-gray hover:text-white text-lg font-bold">&times;</button>
        </div>
        <div class="p-4">
            <div class="flex gap-1 mb-3 bg-white/5 p-1 rounded">
                <div class="flex-1 text-center py-1 bg-white/10 text-purple text-[10px] font-bold rounded cursor-default" style="color:var(--neon-purple)">VIDEO</div>
                <div class="flex-1 text-center py-1 text-gray text-[10px] font-bold cursor-pointer hover:text-white">RADIO</div>
            </div>
            <div class="border border-dashed border-white/10 p-4 rounded bg-black/50 text-center">
                <p class="text-[10px] text-gray mb-2 font-mono">Uplink Status: STANDBY</p>
                <button class="bg-purple-600 text-white text-[10px] font-bold py-2 px-4 rounded w-full flex items-center justify-center gap-2" style="background:#9333ea">
                    <span>INITIALIZE BROADCAST</span>
                </button>
            </div>
        </div>
    </div>

    <!-- IDE OVERLAY -->
    <div id="code-editor-overlay" class="hidden">
        <div class="editor-toolbar">
            <div class="flex gap-2">
                <div style="width:12px;height:12px;border-radius:50%;background:#ef4444"></div>
                <div style="width:12px;height:12px;border-radius:50%;background:#f59e0b"></div>
                <div style="width:12px;height:12px;border-radius:50%;background:#22c55e"></div>
            </div>
            <span class="text-gray text-xs font-mono">SYSTEM_EDITOR_V3.0</span>
            <div class="flex gap-2">
                 <button id="btn-run-preview" class="text-[10px] bg-black border border-white/20 hover:bg-white hover:text-black px-2 rounded font-mono font-bold">RUN PREVIEW</button>
                 <button id="btn-close-ide" class="text-white hover:text-red-400 font-bold text-lg px-2">&times;</button>
            </div>
        </div>
        <div class="editor-layout">
            <textarea id="code-area" spellcheck="false" placeholder="// Write code here..."></textarea>
            <div id="preview-area">
                <button id="btn-hide-preview" class="absolute top-2 right-2 bg-red-600 text-white text-[9px] px-2 py-1 rounded font-bold z-20">CLOSE</button>
                <iframe id="preview-frame" style="width:100%;height:100%;border:none;"></iframe>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION SCRIPT (ES6 MODULES) -->
    <script type="module">
        // IMPORTS FROM CDN (No local build required)
        import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';
        import DOMPurify from 'https://cdn.jsdelivr.net/npm/dompurify/dist/purify.es.mjs';

        // --- CONFIG & STATE ---
        const CONFIG = {
            STORAGE_KEY: 'termos_groq_api_key',
            // FIX: Updated to llama-3.1-8b-instant (Llama 3.1 family, highly available)
            DEFAULT_MODEL: 'llama-3.1-8b-instant', 
            MAX_HISTORY: 10
        };

        const state = {
            apiKey: localStorage.getItem(CONFIG.STORAGE_KEY),
            chatHistory: [
                { role: "system", content: "You are a helpful Cyberpunk AI assistant for TermOS. Keep answers concise." }
            ]
        };

        // --- DOM ELEMENTS ---
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const chatContainer = document.getElementById('chat-container');
        const adminPanel = document.getElementById('admin-panel');
        const adminForm = document.getElementById('admin-form');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiStatusDot = document.getElementById('api-status-dot');
        const btnAdmin = document.getElementById('btn-admin');
        
        // IDE Elements
        const btnIde = document.getElementById('btn-ide');
        const ideOverlay = document.getElementById('code-editor-overlay');
        const btnCloseIde = document.getElementById('btn-close-ide');
        const codeArea = document.getElementById('code-area');
        const btnRunPreview = document.getElementById('btn-run-preview');
        const previewArea = document.getElementById('preview-area');
        const previewFrame = document.getElementById('preview-frame');
        const btnHidePreview = document.getElementById('btn-hide-preview');

        // Media Deck Elements
        const btnMediaDeck = document.getElementById('btn-media-deck');
        const mediaDeck = document.getElementById('media-deck');
        const btnCloseDeck = document.getElementById('btn-close-deck');

        // --- BOOT SEQUENCE ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                const bootScreen = document.getElementById('boot-screen');
                bootScreen.style.transition = 'opacity 1s ease';
                bootScreen.style.opacity = '0';
                setTimeout(() => bootScreen.remove(), 1000);
            }, 2000);
        });

        // --- UI TOGGLES ---
        btnAdmin.addEventListener('click', () => {
            adminPanel.classList.toggle('hidden');
            if(!adminPanel.classList.contains('hidden')) apiKeyInput.value = state.apiKey || '';
        });

        btnIde.addEventListener('click', () => ideOverlay.classList.remove('hidden'));
        btnCloseIde.addEventListener('click', () => ideOverlay.classList.add('hidden'));

        btnMediaDeck.addEventListener('click', () => mediaDeck.classList.toggle('active'));
        btnCloseDeck.addEventListener('click', () => mediaDeck.classList.remove('active'));

        // --- IDE LOGIC ---
        btnRunPreview.addEventListener('click', () => {
            const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            doc.open();
            doc.write(codeArea.value);
            doc.close();
            previewArea.classList.add('show');
        });
        btnHidePreview.addEventListener('click', () => previewArea.classList.remove('show'));

        // --- CHAT LOGIC ---

        function addMessage(html, isUser = false) {
            const div = document.createElement('div');
            div.className = `message ${isUser ? 'user' : 'ai'}`;
            
            const avatar = isUser ? 'U' : 'AI';
            const avatarClass = isUser ? 'user' : 'ai';
            
            // Using 'bubble' class for consistent styling
            div.innerHTML = `
                <div class="avatar ${avatarClass}">${avatar}</div>
                <div class="bubble ${isUser ? '' : 'glass'}">${html}</div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Highlight code blocks after injection
            div.querySelectorAll('pre code').forEach((block) => {
                if(window.hljs) window.hljs.highlightElement(block);
            });
        }

        async function getAIResponse(prompt) {
            if (!state.apiKey) throw new Error("API Key missing. Configure in Admin Panel.");

            state.chatHistory.push({ role: "user", content: prompt });

            // Trim history
            if (state.chatHistory.length > CONFIG.MAX_HISTORY + 1) {
                state.chatHistory = [state.chatHistory[0], ...state.chatHistory.slice(-(CONFIG.MAX_HISTORY))];
            }

            try {
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${state.apiKey}`, 
                        "Content-Type": "application/json" 
                    },
                    body: JSON.stringify({
                        model: CONFIG.DEFAULT_MODEL,
                        messages: state.chatHistory,
                        temperature: 0.6
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    console.error("Groq API Error:", data);
                    if (data.error?.message.includes('length')) throw new Error("Context limit reached. Memory wiped.");
                    throw new Error(data.error?.message || "API Connection Failed");
                }
                
                const content = data.choices[0].message.content;
                state.chatHistory.push({ role: "assistant", content: content });
                
                // Use imported modules
                return DOMPurify.sanitize(marked.parse(content));

            } catch (error) {
                if (error.message.includes('Context limit')) {
                    state.chatHistory = [state.chatHistory[0]];
                }
                throw error;
            }
        }

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Essential to stop reload
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            addMessage(text, true);

            // Basic command parsing
            if (text.startsWith('/ai') || text.startsWith('/')) {
                const prompt = text.replace(/^\/(ai)?\s*/, '').trim();
                if (!prompt) return;

                // Loading State
                const loadingId = 'loading-' + Date.now();
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message ai';
                loadingDiv.innerHTML = `<div class="avatar ai">AI</div><div class="bubble glass text-xs font-mono text-cyan" style="color:var(--neon-cyan)">>> TRANSMITTING DATA...</div>`;
                chatContainer.appendChild(loadingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                try {
                    const response = await getAIResponse(prompt);
                    loadingDiv.remove(); // Remove loading indicator
                    addMessage(response);
                } catch (err) {
                    loadingDiv.remove();
                    console.error(err);
                    addMessage(`<span style="color:#ef4444;font-weight:bold">SYSTEM ERROR:</span> <span style="color:#e5e5e5">${err.message}</span>`);
                }
            } else {
                addMessage("Command unknown. Type <code>/ai</code> before your message.");
            }
        });

        // --- ADMIN FORM LOGIC ---
        adminForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem(CONFIG.STORAGE_KEY, key);
                state.apiKey = key;
                apiStatusDot.style.background = "#22c55e"; // Green
                apiStatusDot.style.boxShadow = "0 0 8px #22c55e";
                adminPanel.classList.add('hidden');
                addMessage(">> API KEY SAVED. NEURAL LINK ESTABLISHED.");
            }
        });

        if (state.apiKey) {
            apiStatusDot.style.background = "#22c55e";
            apiStatusDot.style.boxShadow = "0 0 8px #22c55e";
        }

        document.getElementById('btn-reset-sys').addEventListener('click', () => {
            localStorage.removeItem(CONFIG.STORAGE_KEY);
            location.reload();
        });

        // --- GALAXY CANVAS ---
        const canvas = document.getElementById('galaxy-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, stars = [];
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            stars = Array.from({length: 150}, () => ({
                x: Math.random() * width, y: Math.random() * height,
                size: Math.random() * 2, speed: Math.random() * 0.5 + 0.1
            }));
        }
        function animate() {
            ctx.fillStyle = '#050505'; ctx.fillRect(0,0,width,height);
            ctx.fillStyle = '#fff';
            stars.forEach(s => {
                ctx.globalAlpha = Math.random() * 0.5 + 0.5;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
                s.y -= s.speed; if(s.y < 0) s.y = height;
            });
            requestAnimationFrame(animate);
        }
        window.addEventListener('resize', resize); resize(); animate();
    </script>
</body>
</html>
